<!DOCTYPE html>

<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

  <title>Ubicua Cloud</title>

  <link rel="shortcut icon" href="assets/images/5797ico3.png" />
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin"
    rel="stylesheet" type="text/css">
  <link href="assets/css/ionicons.min.css" rel="stylesheet" type="text/css">
  <link href="assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link href="assets/css/emoji.css" rel="stylesheet" type="text/css" />
  <link href="assets/css/wppstyle.css" rel="stylesheet" type="text/css">

  <!-- Function for the proper stylesheet loading according to the demo settings -->
  <script>function _pxDemo_loadStylesheet(a, b, c) { var c = c || decodeURIComponent((new RegExp(";\\s*" + encodeURIComponent("px-demo-theme") + "\\s*=\\s*([^;]+)\\s*;", "g").exec(";" + document.cookie + ";") || [])[1] || "default"), d = "rtl" === document.getElementsByTagName("html")[0].getAttribute("dir"); document.write(a.replace(/^(.*?)((?:\.min)?\.css)$/, '<link href="$1' + (c.indexOf("dark") !== -1 && a.indexOf("/css/") !== -1 && a.indexOf("/themes/") === -1 ? "-dark" : "") + (!d || 0 !== a.indexOf("assets/css") && 0 !== a.indexOf("assets/demo") ? "" : ".rtl") + '$2" rel="stylesheet" type="text/css"' + (b ? 'class="' + b + '"' : "") + ">")) }</script>

  <!-- Set RTL direction -->
  <script>"ltr" !== document.getElementsByTagName("html")[0].getAttribute("dir") && "1" === decodeURIComponent((new RegExp(";\\s*" + encodeURIComponent("px-demo-rtl") + "\\s*=\\s*([^;]+)\\s*;", "g").exec(";" + document.cookie + ";") || [])[1] || "0") && document.getElementsByTagName("html")[0].setAttribute("dir", "rtl");</script>

  <!-- Load PixelAdmin core stylesheets -->
  <script>
    _pxDemo_loadStylesheet('assets/css/bootstrap.min.css', 'px-demo-stylesheet-bs');
    _pxDemo_loadStylesheet('assets/css/pixeladmin.min.css', 'px-demo-stylesheet-core');
    _pxDemo_loadStylesheet('assets/css/widgets.min.css', 'px-demo-stylesheet-widgets');
  </script>

  <!-- Load theme -->
  <script>
    function _pxDemo_loadTheme(a) { var b = decodeURIComponent((new RegExp(";\\s*" + encodeURIComponent("px-demo-theme") + "\\s*=\\s*([^;]+)\\s*;", "g").exec(";" + document.cookie + ";") || [])[1] || "default"); _pxDemo_loadStylesheet(a + b + ".min.css", "px-demo-stylesheet-theme", b) }
    _pxDemo_loadTheme('assets/css/themes/');
  </script>

  <!-- Pace.js -->
  <script src="assets/pace/pace.min.js"></script>
  <script src="assets/demo/demo.js"></script>
  <script src="assets/js/dinamyctest.js"></script>
  <script src="assets/js/socket.io.js"></script>
  <script src="assets/js/emoji.js"></script>

  <!-- Custom styling -->
  <style>
    .box,
    .box-row,
    .box-cell {
      overflow: visible !important;
      -webkit-mask-image: none !important;
      mask-image: none !important;
    }

    .page-messages-container>.box-row>.box-cell {
      display: block !important;
    }

    .page-messages-label {
      width: 8px;
      height: 8px;
      display: block;
      border-radius: 999px;
      float: left;
      margin-top: 6px;
      margin-right: 12px;
    }

    html[dir="rtl"] .page-messages-label {
      float: right;
      margin-left: 12px;
      margin-right: 0;
    }

    #page-messages-aside-nav {
      max-height: 0;
      overflow: hidden;
      -webkit-transition: max-height .3s;
      transition: max-height .3s;
    }

    #page-messages-aside-nav.show {
      max-height: 2000px;
    }

    @media (min-width: 768px) {
      .page-messages-container>.box-row>.box-cell {
        display: table-cell !important;
        padding-top: 15px;
      }

      .page-messages-aside {
        width: 200px;
      }

      .page-messages-content {
        padding-left: 20px;
      }

      html[dir="rtl"] .page-messages-content {
        padding-left: 0;
        padding-right: 20px;
      }

      #page-messages-aside-nav {
        max-height: none !important;
      }

      .page-messages-wide-buttons .btn {
        width: 60px;
      }
    }

    /* Special styles */

    .page-messages-item-label {
      vertical-align: text-bottom;
    }

    .textarea-container {
      position: relative;
      width: 50%;
      max-height: 100px;
    }

    textarea,
    .textarea-size {
      min-height: 25px;
      font-family: sans-serif;
      font-size: 14px;
      box-sizing: border-box;
      padding: 4px;
      border: 1px solid;
      overflow: hidden;
      width: 100%;
    }

    textarea {
      height: 100%;
      position: absolute;
      resize: none;
      white-space: normal;
    }

    .textarea-size {
      visibility: hidden;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .custom-layer {
      text-align: center;
      padding: 10px;
    }

    .onhover:hover {
      background-color: #d3cfcf;
      border-radius: 50px
    }

    .modal_1 {
      background-color: #008a7c;
      border-color: #008a7c;
    }

    .modal_1_btn_1 {
      background-color: #008a7c;
      border-color: #008a7c;
      width: 150px;
    }

    .modal_1_btn_2 {
      background-color: #008a7c;
      border-color: #008a7c;
      width: 150px;
      margin-left: 10px;
    }

    .modal_1_btn_3 {
      background-color: #008a7c;
      border-color: #008a7c;
      width: 150px;
      margin-top: 10px;
    }

    .modal_1_btn_4 {
      background-color: #008a7c;
      border-color: #008a7c;
      width: 150px;
      margin-top: 10px;
      margin-left: 10px;
    }

    .grid_btn_modal_1 {
      display: grid;
      justify-items: center;
      align-items: center;
      grid-template-columns: 1fr 1fr;
      grid-gap: 1vw;
    }

    .btnCallings {
      background-color: #59C4E4;
      border-radius: 5px;
      border: none;
      padding-top: 1vh;
      padding-bottom: 1vh;
      padding-left: 1vw;
      padding-right: 1vw;
      color: #fff;
    }
  </style>
  <!-- / Custom styling -->
</head>

<body>

  <!-- Header -->
  <nav id="navbar2" class="navbar px-navbar">
    <div class="navbar-header" style="background-color: #3D4A5D; padding-top: 5px;">
      <a class="navbar-brand px-demo-brand">
        <n class="page-header-icon" style="color: white">Atendimento WhatsApp</n>
        <img src="assets/images/logo-ubc.png" style="width: 182px; height: 40px;display:none;">
        <i id="iwa" class="fa fa-bullseye" data-toggle="tooltip" data-placement="bottom"></i>
      </a>
    </div>

    <!-- Navbar togglers -->
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#px-demo-navbar-collapse"
      aria-expanded="false">
      <i class="navbar-toggle-icon" style="display:none;"></i>
    </button>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="px-demo-navbar-collapse" style="background-color: #3D4A5D">

      <ul class="nav navbar-nav navbar-right">
        <li style="display:none;">
          <form class="navbar-form" role="search" style="display:none;">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="sdfsd" style="width: 140px;">
            </div>
          </form>
        </li>

        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
            aria-expanded="false">
            <img src="assets/demo/avatars/avatar.png" alt="" class="px-navbar-image">
            <span id="lboperador" class="hidden-md" style="color:white"></span>
          </a>
          <ul class="dropdown-menu">
            <li>
              <a id="btnlogout" href="#">
                <i class="dropdown-icon fa fa-power-off"></i>&nbsp;&nbsp;Log Out
              </a>
            </li>
          </ul>
        </li>
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </nav>

  <div class="px-content" style="padding-bottom: 0px; padding-top: 15px">
    <div class="page-messages-container box m-a-0 bg-transparent position-static">
      <div class="box-row">

        <div id="contactbar" class="panel-heading"
          style="border-style: solid; border-width: 1px; border-color: #e2e2e2; background-color: #3D4A5D; color: #FFF">

          <span class="panel-title">Receptivo</span>

          <div id="atendenv" class="box-cell pull-right" style="width: 170px; border-style: none;">
            <a id="nvatend" class="btn btn-block btn-primary">
              <span class="btn btn-primary btn-label-icon left ion-person-add"></span>Atender Fila
              <span id="filain" class="badge" style="margin-left:5px ">0</span>
            </a>
          </div>

        </div>

        <div id="contatos" class="panel" style="width: 50; overflow-y: auto; margin-bottom: 3vh">

          <div class="tab-pane fade in active" id="profile-following">
            <ul id="ulConversation" style="list-style-type: none; padding-left: 0px">

            </ul>
          </div>

        </div>

        <div id="contactbar2" class="panel-heading"
          style="border-style: solid; border-width: 1px; border-color: #e2e2e2; background-color: #3D4A5D; color: #FFF">

          <span class="panel-title">Ativo</span>

          <div id="btnchamar" class="box-cell pull-right" style="width: 170px; border-style: none;">
            <a class="btn btn-block btn-primary">
              <span class="btn btn-primary btn-label-icon left fa fa-search"></span>Chamar
            </a>
          </div>

        </div>

        <div id="contatos2" class="panel" style="width: 50; overflow-y: auto; margin-bottom: 0px;">

          <div class="tab-pane fade in active" id="profile-following">
            <ul id="ulConversation2" style="list-style-type: none; padding-left: 0px">

            </ul>
          </div>

        </div>

        <div class="page-messages-content box-cell valign-top" style="width: 70%; padding-top: 0px;">

          <div id="chatbar" class="panel-heading"
            style="max-height: 55px; border-style: solid; border-width: 1px; border-color: #e2e2e2; background-color: #3D4A5D; color: #FFF">

            <img id="imgchat11" src="" alt="" class="widget-profile-avatar" style="width: 30px; height: 30px;">

            <span id="namchat11" class="panel-title valign-middle" style="margin-left: 1%"></span>

            <div class="pull-right" role="toolbar">
              <div class="btn-group">
                <button id="btnconsulta" type="button" class="btn btn-primary" data-toggle="tooltip"
                  data-placement="bottom" title="Consulta Atendimentos" style="width: 100px;">
                  <i class="fa fa-search"></i> Consulta
                </button>
              </div>
              <div class="btn-group">
                <button id="btncadastro" type="button" class="btn btn-primary" data-toggle="tooltip"
                  data-placement="bottom" title="Dados do Contato" style="width: 100px;">
                  <i class="fa fa-pencil-square-o"></i> Cadastro
                </button>
              </div>
              <div class="btn-group">
                <button id="btnhistorico" type="button" class="btn btn-primary" data-toggle="tooltip"
                  data-placement="bottom" title="Exibe o Histórico da Última Interação" style="width: 100px">
                  <i class="fa fa-comments"></i> Histórico
                </button>
              </div>
              <div class="btn-group">
                <button id="btntransferir" type="button" class="btn btn-primary" data-toggle="tooltip"
                  data-placement="bottom" title="Transferir Contato para Outro Atendente" style="width: 100px;">
                  <i class="fa fa-external-link"></i> Transferir
                </button>
              </div>
              <div class="btn-group">
                <button id="btnencerrar" type="button" class="btn btn-primary" data-toggle="tooltip"
                  data-placement="bottom" title="Encerrar Atendimento" style="width: 100px;">
                  <i class="fa fa-sign-out"></i> Encerrar
                </button>
              </div>
            </div>
          </div>

          <div id="chatbox" class="panel" style="margin-bottom: 0px">

            <div class="panel-body p-y-1 clearfix">

              <div id="chat11" class="panel scrollstyle" style="overflow-y: auto; max-height: 65vh; min-height: 65vh">
                <div id="newchat">
                  <img src="assets/images/newchat.png" style="width: 60%; margin-left: 20%; margin-top: 2%">
                </div>
              </div>

              <form class="conversation-compose"
                style="border-style: solid; border-width: 1px; border-color: #e2e2e2; border-radius: 25px"
                onSubmit="return false;">
                <input id="inputmsgtxt" class="input-msg" name="input" placeholder="Digite uma mensagem"
                  autocomplete="off" autofocus style="padding-left: 25px"
                  onkeypress="detect_enter_keyboard(event)"></input>
                <div id="froala-editor" class="photo onhover" onclick="attachcp()">
                  <i class="ion-android-attach"></i>
                </div>
                <!--<div class="photo onhover">
                  <i class="ion-android-image"></i> 
                </div>-->
                <a id="sendmsgtxt" class="send">
                  <div class="circle">
                    <i class="ion-android-send"></i>
                  </div>
                </a>
              </form>

            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalEncerrar" tabindex="-1">
      <div id="boxContent" class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h4 class="modal-title" id="myModalLabel1">Encerrar Atendimento</h4>
          </div>
          <div id="myBoxgrid" class="modal-body">
            <div id="bdRightBox">
              <!---->
              <h5 class="m-t-0">Selecione um Status para Encerrar o Atendimento</h5>
              <div class="input-group">
                <span class="input-group-addon"><i class="ion-information-circled"></i><label class="required" /></span>
                <div class="form-group">
                  <div class="col-xs-19">
                    <select id="icbStatus" class="form-control">
                      <option>Selecione</option>
                    </select>
                  </div>
                </div>
              </div>
              <br>
              <div class="input-group">
                <span class="input-group-addon"><i class="fa fa-building-o"></i></span>
                <input id="iCNPJ" type="text" class="form-control" placeholder="CNPJ">
              </div>
              <br>
              <!---->
              <div id="novoPedido" style="display: none">
                <h5 class="m-t-0">Tabular Novo Pedido <span id="fillWarning" class="fillWarning"></span></h5>
                <div class="input-group">
                  <span class="input-group-addon"><i class="fa fa-scribd"></i></span>
                  <div class="form-group">
                    <div class="col-xs-19">
                      <select id="icbSegmento" class="form-control">
                        <option value=''>Segmento</option>
                        <option>CHC</option>
                        <option>GEM</option>
                        <option>ONE</option>
                        <option>OUTROS</option>
                      </select>
                    </div>
                  </div>
                </div>
                <br>
                <div class="input-group">
                  <span class="input-group-addon"><i class="fa fa-pencil-square-o"></i></span>
                  <input id="iPedido" type="text" onkeypress="return isNumberKey(event)" class="form-control"
                    placeholder="Número do Pedido">
                </div>
                <br>
                <div class="input-group">
                  <span class="input-group-addon"><i class="fa fa-money"></i></span>
                  <input id="iValor" type="text" onkeypress="return isNumberKey(event)" class="form-control"
                    placeholder="Valor R$">
                </div>
                <br>
                <button id="addPedido" type="button" class="btn btn-success">Adcionar</button>
              </div>
              <!---->
            </div>
            <div id="listaPedido" class="bdLeft pedTable" style="display: none">
              <h5 class="m-t-0">Pedidos</h5>
              <table id="myTable" class="table">
                <thead>
                  <tr>
                    <th data-override="segmento">Segmento</th>
                    <th data-override="pedido">Número do Pedido</th>
                    <th data-override="valor">Valor R$</th>
                    <th>Deletar</th>
                  </tr>
                </thead>
                <tbody id="myPedidos">

                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button id="cancelarenc" type="button" class="btn" data-dismiss="modal">Cancelar</button>
            <button id="confirmaenc" type="button" class="btn btn-primary">Encerrar</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalTransferir" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button id="fechartra" type="button" class="close" data-dismiss="modal">×</button>
            <h4 class="modal-title" id="myModalLabel1">Transferir Atendimento</h4>
          </div>
          <div class="modal-body">
            <h5 class="m-t-0">Selecione um Atendente Online</h5>
            <div class="form-group">
              <div class="col-xs-19">
                <select id="cbatendentesonline" class="form-control">
                  <option>Selecione</option>
                </select>
              </div>
            </div>
            <br />
          </div>
          <div class="modal-footer">
            <button id="cancelartra" type="button" class="btn" data-target="#edfecha"
              data-dismiss="modal">Cancelar</button>
            <button id="confirmatra" type="button" class="btn btn-primary">Transferir</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalHistorico" tabindex="-1" style="height: 600px;">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button id="fecharhis" type="button" class="close" data-dismiss="modal">×</button>
            <h4 class="modal-title">Histórico da Última Interação</h4>
          </div>
          <div class="modal-body"
            style="padding-left: 10px; padding-right: 10px; padding-top: 10px; padding-bottom: 10px;">
            <div id="chathistory" class="panel scrollstyle" style="overflow-y: auto; height: 400px;">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="myModal2" class="modal fade modal-alert modal-danger">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><i class="fa fa-times-circle"></i></div>
          <div class="modal-title">AVISO</div>
          <div class="modal-body">Tem certeza que deseja finalizar o atendimento?</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">NÃO</button>
            <button type="button" class="btn btn-danger" data-dismiss="modal">SIM</button>
          </div>
        </div>
      </div>
    </div>

    <div id="myModal3" class="modal fade modal-alert modal-info">
      <div id="modalloading" class="modal-dialog" style="width: 500px">
        <div class="modal-content">
          <div class="modal-header" style="background-color: #008a7c; border-color: #008a7c"><i
              class="fa ion-android-attach"></i></div>
          <div class="modal-title">Aviso</div>
          <div class="modal-body">Que tipo de arquivo deseja enviar?</div>
          <div class="modal-footer">
            <button id="docins" type="button" class="btn btn-info"
              style="background-color: #008a7c; border-color: #008a7c; width: 150px">
              <span class="btn-label-icon left fa ion-android-document"></span>Documento
            </button>

            <button id="audins" type="button" class="btn btn-info" style="background-color: #008a7c; border-color: #008a7c; width: 150px;
                        margin-left: 10px">
              <span class="btn-label-icon left fa ion-headphone"></span>Audio
            </button>
            <br>
            <button id="vidins" type="button" class="btn btn-info" style="background-color: #008a7c; border-color: #008a7c; width: 150px; 
                        margin-top: 10px">
              <span class="btn-label-icon left fa ion-ios-videocam"></span>Vídeo
            </button>

            <button id="imgins" type="button" class="btn btn-info" style="background-color: #008a7c; border-color: #008a7c; width: 150px;
                        margin-top: 10px; margin-left: 10px">
              <span class="btn-label-icon left fa ion-android-image"></span>Imagem
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="myModal" class="modal fade modal-alert modal-warning">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><i class="fa ion-alert"></i></div>
          <div class="modal-title">Aviso</div>
          <div class="modal-body">Não Há Contatos na Fila !</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-warning" data-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <div id="myModal7" class="modal fade modal-alert modal-warning">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><i class="fa ion-alert"></i></div>
          <div class="modal-title">Aviso</div>
          <div class="modal-body">Nenhum Contato Selecionado !</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-warning" data-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <div id="myModal8" class="modal fade modal-alert modal-warning">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><i class="fa ion-alert"></i></div>
          <div class="modal-title">Aviso</div>
          <div class="modal-body">Nenhum Atendente Online !</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-warning" data-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <div id="myModal9" class="modal fade modal-alert modal-warning">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><i class="fa ion-alert"></i></div>
          <div class="modal-title">Aviso</div>
          <div class="modal-body">Não Há Nenhum Histórico Desse Contato !</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-warning" data-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <div id="myModal5" class="modal fade modal-alert modal-warning">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><i class="fa ion-alert"></i></div>
          <div class="modal-title">Aviso</div>
          <div class="modal-body">Campo de Texto Vazio !</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-warning" data-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <div id="myModal6" class="modal fade modal-alert modal-warning">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><i class="fa ion-alert"></i></div>
          <div class="modal-title">Aviso</div>
          <div class="modal-body">Nenhum Atendimento Iniciado!</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-warning" data-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <div id="myModalaudio" class="modal fade modal-alert modal-warning">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header" style="background-color: #008376"><i class="ion-android-microphone"
              style="color: white;"></i></div>
          <div class="modal-title">Gravar Audio</div>
          <div class="modal-body">Gravando <i class="ion-android-radio-button-on" style="color: red;"></i></div>
          <div class="modal-footer">
            <button type="button" class="btn" data-dismiss="modal" style="background-color: #f6f6f6">Cancelar</button>
            <button type="button" class="btn" data-dismiss="modal"
              style="background-color: #008376; color: white">Gravar</button><br>
            <button type="button" class="btn" data-dismiss="modal"
              style="margin-top: 10px; background-color: #f6f6f6">Ouvir</button>
            <button type="button" class="btn" data-dismiss="modal"
              style="margin-top: 10px; background-color: #008376; color: white">Enviar</button>
          </div>
        </div>
      </div>
    </div>

    <button id="growl-success" class="btn btn-success" style="display: none;"></button>

    <footer class="px-footer px-footer-bottom p-t-0" style="vertical-align: middle;display:none;">
      <hr class="page-wide-block">
      <span class="text-muted">2018 Powered Ubicua Cloud</span>
    </footer>

    <input id="inseririmg" type="file" name="myImage" accept="image/*" style="display: none;" />
    <input id="inserirvid" type="file" name="myImage" accept="video/mp4" style="display: none;" />
    <input id="inseriraudio" type="file" name="myImage" accept="audio/*" style="display: none;" />
    <input id="inserirdoc" type="file" name="myImage" style="display: none;" />

    <div id="myModal12" class="modal">
      <span class="close">&times;</span>
      <img class="modal-content" id="img01">
      <div id="caption"></div>
    </div>

    <div id="myModalchamar" class="modal fade modal-alert modal-info">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header modal_1"><i class="fa ion-reply"></i></div>
          <div class="modal-title">Chamar Cliente</div>
          <br>
          <div class="modal-body grid_btn_modal_1">
            <div>
              <button id="btnMulti" type="button" class="btnCallings" data-dismiss="modal">Clientes CHC/ONE</button>
            </div>
            <div>
              <button id="btnHeavy" type="button" class="btnCallings" data-dismiss="modal">Clientes CEM</button>
            </div>
          </div>
          <div class="modal-footer">
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="mailModal">
      <div class="modal-dialog" style="width: 900px !important;margin: 30px auto !important;">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 class="modal-title">Chamar Clientes</h3>
          </div>
          <div class="modal-body">
            <table id="table_id" class="table table-striped table-bordered" style="width:100%">
              <thead>
                <tr>
                  <th>Nome</th>
                  <th>Nome Fantasia</th>
                  <th>Flag Campanha</th>
                  <th>Cnpj</th>
                  <th>Numero</th>
                  <th>Chamar</th>
                  <th>Selecionar</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default " data-dismiss="modal">Fechar</button>
            <button id="callAll" type="button" class="btn btn-primary " data-dismiss="modal"><span
                class="ion-person-add"></span>&nbsp;&nbsp;Chamar</button>
          </div>
        </div>
      </div>
    </div>


    <div id="modalAtende" class="modal fade modal-alert modal-warning">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><i class="fa ion-alert"></i></div>
          <div class="modal-title">Aviso</div>
          <div class="modal-body">Este numero já se encontra em atendimento!</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-warning" data-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <div id="modalNoMail" class="modal fade modal-alert modal-warning">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header"><i class="fa ion-alert"></i></div>
          <div class="modal-title">Aviso</div>
          <div class="modal-body">Nenhum registro encontrado!</div>
          <div class="modal-footer">
            <button type="button" class="btn btn-warning" data-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ==============================================================================
  |
  |  SCRIPTS
  |
  =============================================================================== -->

    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/pixeladmin.min.js"></script>
    <script src="assets/js/ubicua.js"></script>

    <script>
      // -------------------------------------------------------------------------
      $(function () {
        pxDemo.initializeDemoSidebar();

        $('#px-demo-sidebar').pxSidebar();
        pxDemo.initializeDemo();
      });

      $('#imgins').click(function () { $('#inseririmg').trigger('click'); });
      $('#vidins').click(function () { $('#inserirvid').trigger('click'); });
      $('#audins').click(function () { $('#inseriraudio').trigger('click'); });
      $('#docins').click(function () { $('#inserirdoc').trigger('click'); });

    </script>

    <script type="text/javascript">
      // -------------------------------------------------------------------------
      // Initialize DEMO

      $(function () {
        var file = String(document.location).split('/').pop();

        // Remove unnecessary file parts
        file = file.replace(/(\.html).*/i, '$1');

        if (!/.html$/i.test(file)) {
          file = 'index.html';
        }

        // Activate current nav item
        $('body > .px-nav')
          .find('.px-nav-item > a[href="' + file + '"]')
          .parent()
          .addClass('active');

        $('body > .px-nav').pxNav();
        $('body > .px-footer').pxFooter();

        $('#navbar-notifications').perfectScrollbar();
        $('#navbar-messages').perfectScrollbar();
      });

    </script>

    <script>
      // -------------------------------------------------------------------------
      // Initialize page components

      $(function () {
        $('#page-messages-aside-nav-toggle').on('click', function () {
          $(this)[
            $('#page-messages-aside-nav').toggleClass('show').hasClass('show') ? 'addClass' : 'removeClass'
          ]('active');
        });

        $('#page-messages-item-form').pxExpandingInput();

        $('#page-messages-item-form').on('expanded.px.expanding-input', function (e) {
          $(this).find('textarea').summernote({
            height: 200,
            toolbar: [
              ['parastyle', ['style']],
              ['fontstyle', ['fontname', 'fontsize']],
              ['style', ['bold', 'italic', 'underline', 'clear']],
              ['font', ['strikethrough', 'superscript', 'subscript']],
              ['color', ['color']],
              ['para', ['ul', 'ol', 'paragraph']],
              ['height', ['height']],
              ['insert', ['picture', 'link', 'video', 'table', 'hr']],
              ['history', ['undo', 'redo']],
              ['misc', ['codeview', 'fullscreen']],
              ['help', ['help']]
            ],
          });
        });
      });
    </script>
    <script src="assets/js/jquery.tabletojson.min.js"></script>
    <script>
      /********************************************************************************************************************************************************/

      var json;
      var aton = 0;
      var socket = io.connect();
      var idcontato = 0;
      var appwa = 'https://cdn.ubicuacloud.com/upload';
      var operador = sessionStorage.getItem('fkname');
      var allClients = [];
      $('#lboperador').text(operador);
      $('#iCNPJ').mask('99.999.999/9999-99');
      // Usuário Logado ?
      if (sessionStorage.getItem('fkname') == null) {
        window.location = "index.html";
      }

      /********************************************************************************************************************************************************/

      socket.on('connect', function () {
        console.log('------------------------CONECTADO-----CONECTADO------------------------------------');
        socket.emit('bi-atendein', { fkid: sessionStorage.getItem('fkid') });
      });

      /********************************************************************************************************************************************************/

      socket.on('disconnect', function () {
        console.log('------------------------DESCONECTADO-----DESCONECTADO------------------------------');
      });

      /********************************************************************************************************************************************************/

      socket.on("force_disconnect", function () {
        onbtnlogout();
      });

      /********************************************************************************************************************************************************/

      socket.on('sentinel_clients_queue', function (payload) {
        var json = payload;
        if (payload[1].total > 0) {
          var audio = new Audio('assets/aud/tethys.mp3');
          audio.play();
        }
        $('#filain').text(payload[1].total);
        $('#nvatend').removeClass('form-loading');
      });

      /********************************************************************************************************************************************************/

      socket.on('bi-close_chat', function (payload) {

        var json = payload;
        $('#contatos').removeClass('form-loading');
        $('#id' + json.mobile).remove();
        $('#chat' + json.mobile).remove();
        $("#imgchat11").attr('src', '');
        $('#namchat11').text('');

        contactuid = "";
        hidedivs();
        $('#newchat').fadeIn(1);
        $('#contatos').removeClass('form-loading');
      });

      /********************************************************************************************************************************************************/

      socket.on('bi-transferagent', function (payload) {

        if (payload.status == 0) {
          $.growl.error({
            title: "Atenção",
            message: "Transferência do Contato <strong>" + payload.mobile + "</strong> Não Realizada, Atendente <strong>" + payload.fkname + "</strong> Não se Encontra mais Online !"
          });
        } else {
          $.growl.success({
            title: "Aviso",
            message: "Transferência do Contato <strong>" + payload.mobile + "</strong> Realizada com Sucesso !"
          });
          // Remover contato da lista
          $('#contatos').removeClass('form-loading');
          $('#id' + payload.mobile).remove();
          $('#chat' + payload.mobile).remove();
          $("#imgchat11").attr('src', '');
          $('#namchat11').text('');
          contactuid = "";
          hidedivs();
          $('#newchat').fadeIn(1);
          $('#contatos').removeClass('form-loading');
        }
      });

      /********************************************************************************************************************************************************/

      socket.on('bi-transferok', function (payload) {

        idcontato = idcontato + 1;
        var numac = payload.mobile;
        var atendir = payload.atendir;
        var atendircolor;
        if (atendir == "in") {
          atendir = "ion-reply";
          atendircolor = 'color: red';
        } else if (atendir == "out") {
          atendir = "ion-forward";
          atendircolor = 'color: green';
        }
        var menu = '';
        menu += modalpis('', payload.mobile, payload.account, payload.photo, atendir, atendircolor);
        if (atendir == 'in') {
          $('#ulConversation').append(menu);
        } else if (atendir == 'out') {
          $('#ulConversation2').append(menu);
        }
        var menu2 = '';
        menu2 += chatbox1(payload.mobile);
        if (document.getElementById("chat" + payload.mobile) == null) {
          $('#chat11').append(menu2);
        }
        if (payload.account != null) {
          $('#ac' + numac).show();
        } else {
          $('#ac' + numac).hide();
        }
        socket.emit('bi-transferok', { mobile: payload.mobile });
      });


      /********************************************************************************************************************************************************/

      socket.on('receive_register', function (payload) {

        var json = payload;
        var mobid = json.mobile;
        $('#a' + mobid).text(json.name);
        $('#namchat11').text(json.name);
        if (json.photo != null) {
          $("#imgchat11").attr('src', 'https://cdn.ubicuacloud.com/file/' + json.photo);
        }
        if (json.account != null) {
        }
      });

      /********************************************************************************************************************************************************/

      socket.on('bi-answer_new_queue', function (payload) {

        idcontato = idcontato + 1;
        var numac = payload.mobile;
        var atendir;
        var menu = modalpis('', payload.mobile, payload.account, payload.photo, 'ion-reply', 'color:red');
        $('#ulConversation').append(menu);
        var menu2 = '';
        menu2 += chatbox1(payload.mobile);
        if (document.getElementById("chat" + payload.mobile) == null) {
          $('#chat11').append(menu2);
        }
        if (payload.account != null) {
          $('#ac' + numac).show();
        } else {
          $('#ac' + numac).hide();
        }
      });

      socket.on('bi-atendein', function (payload) {

        console.log(payload);
        if (payload.logs.length > 0 && payload.contacts.length > 0) {
          var logs = JSON.parse(payload.logs);
          var contacts = JSON.parse(payload.contacts);
          var direction;
          var cx = contacts.length;
          var lx = logs.length;
          for (i = 0; i < cx; i++) {
            var _flagcamp = contacts[i].flagcampanha;
            var _cnpj = contacts[i].cnpj;
            var _tipo = contacts[i].tipo;
            var atendir;
            console.log(_tipo)
            if (_tipo == 1) {
              _tipo = "Multi";
            } else if (_tipo == 2) {
              _tipo = "Recorrente";
            }
            if (contacts[i].atendir == "in") {
              atendir = "ion-reply";
              atendircolor = 'color: red';
              direction = "reply";
            } else if (contacts[i].atendir == "out") {
              atendir = "ion-forward";
              atendircolor = 'color: green';
              direction = "foward";
            }
            $('#chat' + contacts[i].mobile).empty();

            if (contacts[i].account != null) {
              if (document.getElementById("id" + contacts[i].mobile) == null) {
                var menu = '';
                menu += modalpis('', contacts[i].mobile, contacts[i].account, contacts[i].photo, atendir, atendircolor, direction, _tipo, _cnpj, _flagcamp);
                if (contacts[i].atendir == 'in') {
                  $('#ulConversation').append(menu);
                } else if (contacts[i].atendir == 'out') {
                  $('#ulConversation2').append(menu);
                }
              }
              var menu2 = '';
              menu2 += chatbox1(contacts[i].mobile);
              if (document.getElementById("chat" + contacts[i].mobile) == null) {
                $('#chat11').append(menu2);
              }
            } else {
              if (document.getElementById("id" + contacts[i].mobile) == null) {
                var menu = '';
                menu += modalpis('', contacts[i].mobile, '', contacts[i].photo, atendir, atendircolor, direction, _tipo, _cnpj, _flagcamp);
                if (contacts[i].atendir == 'in') {
                  $('#ulConversation').append(menu);
                } else if (contacts[i].atendir == 'out') {
                  $('#ulConversation2').append(menu);
                }
              }
              var menu2 = '';
              menu2 += chatbox1(contacts[i].mobile);
              if (document.getElementById("chat" + contacts[i].mobile) == null) {
                $('#chat11').append(menu2);
              }
            }

            if (contacts[i].account != null) {
              $('#ac' + contacts[i].mobile).show();
            } else {
              $('#ac' + contacts[i].mobile).hide();
            }
          }
          histmsg(contacts, logs);

        }
        socket.emit('add user', { fkid: sessionStorage.getItem('fkid'), fkname: sessionStorage.getItem('fkname') });
      });

      /********************************************************************************************************************************************************/

      socket.on('bi-statusen', function (payload) {
        var _statusen = JSON.parse(payload);
        $("#icbStatus").empty().append("<option value='0'>Selecione</option>");
        for (i = 0; i < _statusen.length; i++) {
          var _option = document.createElement('option');
          _option.value = _statusen[i].id;
          _option.text = _statusen[i].descricao;
          _option.id = _statusen[i].pedido;
          $("#icbStatus").append(_option);
        }
        $('#modalEncerrar').modal();
      });

      /********************************************************************************************************************************************************/

      socket.on('bi-lasthistory', function (payload) {
        if (payload.contacts.length != 0) {
          var logs = JSON.parse(payload.logs);
          var contacts = JSON.parse(payload.contacts);
          console.log(logs);
          onchatmsg(contacts, logs, 'chathistory');
          $('#modalHistorico').modal();
        } else {
          $('#myModal9').modal();
        }
      });

      /********************************************************************************************************************************************************/

      socket.on('waendpoint', function (payload) {
        if (payload.server === "LON") {
          $('#iwa').css({ color: "green" });
          $('#iwa').prop('title', '');
        } else if (payload.server === "SAO") {
          $('#iwa').css({ color: "#ffae42" });
          $('#iwa').prop('title', '');
        } else {
          $('#iwa').css({ color: "red" });
          $('#iwa').prop('title', 'ATENÇÃO: No Momento Estamos Recebendo Apenas Mensagens de Texto !');
        }
      });

      /********************************************************************************************************************************************************/

      socket.on('sentinel_clients_alive', function (payload) {

        if (aton == 0) {
          var _atendentesonline = JSON.parse(payload);
          $("#cbatendentesonline").empty().append("<option value='0'>Selecione</option>");
          for (i = 0; i < _atendentesonline.length; i++) {
            if (_atendentesonline[i].fkid.length == 36) {
              if (sessionStorage.getItem('fkid') != _atendentesonline[i].fkid) {
                var _option = document.createElement('option');
                _option.value = _atendentesonline[i].fkid;
                _option.text = _atendentesonline[i].fkname;
                $("#cbatendentesonline").append(_option);
              }
            }
          }
        }
      });

      /********************************************************************************************************************************************************/

      function onbtnlogout() {
        sessionStorage.clear();
        socket.disconnect();
        window.location = "index.html";
      }

      $("#btnlogout").on("click", function () {
        onbtnlogout();
      });

      $("#addfila").on("click", function () {
        socket.emit('zerafila');
      });

      /********************************************************************************************************************************************************/

      var msg = "";
      var btype = "";
      var bmessage = "";
      var bcaption = "";
      var contactuid = "";

      socket.on('receive_chat', function (payload) {

        msg = payload;
        btype = msg.message_type;
        var d = new Date();
        var bhour = d.getHours();
        var bminute = d.getMinutes();
        if (bminute < 10) {
          bminute = "0" + bminute;
        }

        var btime = '' + bhour + ':' + bminute + '';

        if (btype == 'chat') {
          bmessage = msg.body_text;
          var contact_uid = msg.contact_uid;

          var menu = '';
          menu += msgtxtl(bmessage, contact_uid, btime);

          $('#chat' + contact_uid).append(menu);
          pageScroll();
          var notifica = $('#s' + contact_uid).text();
          var audio = new Audio('assets/aud/tethys.mp3');
          audio.play();
          notifica = Number(notifica) + 1;
          $('#s' + contact_uid).text(notifica);
          $('#s' + contact_uid).fadeIn(1);
        } else if (btype == 'image') {
          bmessage = msg.body_url;
          var contact_uid = msg.contact_uid;
          bcaption = msg.body_caption;

          if (bcaption != '') {
            var menu = '';
            menu += previewimgtx(msg.body_url, contact_uid, btime, bcaption);
            $('#chat' + contact_uid).append(menu);
            pageScroll();
            var notifica = $('#s' + contact_uid).text();
            notifica = Number(notifica) + 1;
            $('#s' + contact_uid).text(notifica);
            $('#s' + contact_uid).fadeIn(1);
          } else {
            var menu = '';
            menu += previewimg(msg.body_url, contact_uid, btime);
            $('#chat' + contact_uid).append(menu);
            pageScroll();
            var notifica = $('#s' + contact_uid).text();
            notifica = Number(notifica) + 1;
            $('#s' + contact_uid).text(notifica);
            $('#s' + contact_uid).fadeIn(1);
          }
        } else if (btype == 'video') {
          bmessage = msg.body_url;
          var contact_uid = msg.contact_uid;
          bcaption = msg.body_caption;
          if (bcaption != '') {
            var menu = '';
            menu += previewvidtx(bmessage, bcaption, contact_uid, btime);
            $('#chat' + contact_uid).append(menu);
            pageScroll();
            var notifica = $('#s' + contact_uid).text();
            console.log(notifica);
            notifica = Number(notifica) + 1;
            $('#s' + contact_uid).text(notifica);
            $('#s' + contact_uid).fadeIn(1);
          } else {
            var menu = '';
            menu += previewvid(bmessage, contact_uid, btime);
            $('#chat' + contact_uid).append(menu);
            pageScroll();
            var notifica = $('#s' + contact_uid).text();
            console.log(notifica);
            notifica = Number(notifica) + 1;
            $('#s' + contact_uid).text(notifica);
            $('#s' + contact_uid).fadeIn(1);
          }
        } else if (btype == 'ptt') {
          bmessage = msg.body_url;
          var contact_uid = msg.contact_uid;
          var menu = '';
          menu += previewaud(bmessage, contact_uid, btime);
          $('#chat' + contact_uid).append(menu);
          pageScroll();
          var notifica = $('#s' + contact_uid).text();
          console.log(notifica);
          notifica = Number(notifica) + 1;
          $('#s' + contact_uid).text(notifica);
          $('#s' + contact_uid).fadeIn(1);
        } else if (btype == 'audio') {
          bmessage = msg.body_url;
          var contact_uid = msg.contact_uid;
          bcaption = msg.body_caption;

          if (bcaption != '') {
            var menu = '';
            menu += previewaudtx(bmessage, bcaption, contact_uid, btime);
            $('#chat' + contact_uid).append(menu);

            pageScroll();

            var notifica = $('#s' + contact_uid).text();
            console.log(notifica);
            notifica = Number(notifica) + 1;
            $('#s' + contact_uid).text(notifica);
            $('#s' + contact_uid).fadeIn(1);
          } else {
            var menu = '';
            menu += previewaud(bmessage, contact_uid, btime);
            $('#chat' + contact_uid).append(menu);

            pageScroll();

            var notifica = $('#s' + contact_uid).text();
            console.log(notifica);
            notifica = Number(notifica) + 1;
            $('#s' + contact_uid).text(notifica);
            $('#s' + contact_uid).fadeIn(1);
          }
        } else if (btype == 'document') {
          bmessage = msg.body_url;
          var contact_uid = msg.contact_uid;
          bcaption = msg.body_caption;

          if (bcaption != '') {
            var menu = '';
            menu += previewdoctx(bmessage, bcaption, contact_uid, btime);
            $('#chat' + contact_uid).append(menu);
            pageScroll();
            var notifica = $('#s' + contact_uid).text();
            console.log(notifica);
            notifica = Number(notifica) + 1;
            $('#s' + contact_uid).text(notifica);
            $('#s' + contact_uid).fadeIn(1);
          } else {
            var menu = '';
            menu += previewdoc(bmessage, contact_uid, btime);
            $('#chat' + contact_uid).append(menu);
            pageScroll();
            var notifica = $('#s' + contact_uid).text();
            console.log(notifica);
            notifica = Number(notifica) + 1;
            $('#s' + contact_uid).text(notifica);
            $('#s' + contact_uid).fadeIn(1);
          }
        }
      });

      /********************************************************************************************************************************************************/

      $("#nvatend").on("click", function () {

        var _filain = $('#filain').text();
        if (_filain > 0) {
          payload = {
            fkid: sessionStorage.getItem('fkid'),
            fkname: sessionStorage.getItem('fkname')
          };
          socket.emit('bi-answer_new_queue', payload);
          $('#nvatend').addClass('form-loading');
        } else {
          $('#myModal').modal();
        }
      });

      /********************************************************************************************************************************************************/

      $("#sendmsgtxt").on("click", function () {

        var msgtext = $('#inputmsgtxt').val();
        if (contactuid != "") {
          if (msgtext != '') {
            var payload = {
              mobile: contactuid,
              type: "chat",
              message: "" + msgtext + ""
            }
            socket.emit('send_chat', payload);

            var d = new Date();
            var bhour = d.getHours();
            var bminute = d.getMinutes();
            if (bminute < 10) {
              bminute = "0" + bminute;
            }
            var btime = '' + bhour + ':' + bminute + '';
            var menu = '';
            menu += msgtxtr(payload.message, operador, btime);
            $('#chat' + contactuid).append(menu);
            pageScroll();
            $('#inputmsgtxt').val(null);
          } else {
            $('#myModal5').modal();
          }
        } else {
          $('#myModal6').modal();
        }
      });

      /********************************************************************************************************************************************************/

      $('#btnconsulta').on('click', function () {
        window.open('consulta.html');
      });

      /********************************************************************************************************************************************************/

      $('#btncadastro').on('click', function () {

        if (contactuid != "") {

          bootbox.prompt({
            title: 'Cadastro',
            callback: function (result) {
              if (result == null) {
                alert('Registro Cancelado');
              } else if (result != null) {
                console.log(result);
                var json2 = {
                  mobile: contactuid,
                  name: result
                }
                console.log(json2);
                socket.emit('send_register', json2);
              }
            },
          });
        } else {
          $('#myModal7').modal();
        }

      });

      /********************************************************************************************************************************************************/

      $('#confirmatra').on('click', function () {
        var _opsel = $('#cbatendentesonline option:selected').val();
        if (_opsel == "0") {
          alert('Atendente Inválido !');
        } else {
          var atendirid = document.getElementById("reply" + contactuid).className;
          var atendircolor = document.getElementById("reply" + contactuid).style.property
          var atendir;
          if (atendirid == "ion-forward") {
            atendir = 'out';
          } else if (atendirid == "ion-reply") {
            atendir = 'in';
          }
          var payload = {
            mobile: contactuid,
            fkid: $('#cbatendentesonline option:selected').val(),
            fkname: $('#cbatendentesonline option:selected').text(),
            message: "<strong>Atendimento Transferido para: " + $('#cbatendentesonline option:selected').text() + "</strong>",
            atendir: atendir
          }
          socket.emit('bi-transferagent', payload);
          aton = 0;
          $('#modalTransferir').modal('hide');
        }
      });

      $('#cancelartra').on('click', function () {
        aton = 0;
      });

      $('#fechartra').on('click', function () {
        aton = 0;
      });

      $('#btntransferir').on('click', function () {

        if (contactuid != "") {
          if ($('#cbatendentesonline').children('option').length < 2) {
            $('#myModal8').modal();
          } else {
            aton = 1;
            $('#modalTransferir').modal();
          }
        } else {
          $('#myModal7').modal();
        }
      });

      $('#btnhistorico').on('click', function () {

        if (contactuid != "") {
          $("#chathistory").empty();
          var payload = {
            mobile: contactuid
          }
          socket.emit('bi-lasthistory', payload);
        } else {
          $('#myModal7').modal();
        }
      });

      $('#btnencerrar').on('click', function () {
        clearTable();

        if (contactuid != "") {
          $("#icbSegmento").empty().append("<option value=''>Segmento</option><option>CHC</option><option>GEM</option><option>ONE</option><option>OUTROS</option>");
          $("#iCNPJ").val('');
          $("#iPedido").val('');
          $("#iValor").val('');
          socket.emit('bi-statusen');
        } else {
          $('#myModal7').modal();
        }

      });

      /********************************************************************************************************************************************************/

      var msgz = 0;

      $("#btn").on("click", function () {

        console.log('opa');
        $("#ulConversation").html(

          $("#ulConversation").children("li").sort(function (a, b) {

            return $(a).val() - $(b).val();

          })

        );

      });


      $('#inseririmg').change(function () {
        console.log('bate');
        var file = this.files[0];
        // This code is only for demo ...
        console.log("name : " + file.name);
        console.log("size : " + file.size);
        console.log("type : " + file.type);
        console.log("date : " + file.lastModified);
        uplimg();
      });

      var hashimg = "";
      var reshashimg;
      var finhashimg;

      function uplimg() {
        var file = inseririmg.files[0];
        console.log(">>>> Enviando novo img...");
        console.log("name : " + file.name);
        console.log("size : " + file.size);
        console.log("type : " + file.type);
        console.log("date : " + file.lastModified);
        console.log("");
        uploadFileimg(inseririmg.files[0]);

      }

      async function uploadFileimg(file) {
        $('#modalloading').addClass('form-loading');
        var url = appwa;
        var xhr = new XMLHttpRequest();
        var fd = new FormData();
        xhr.open("POST", url, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            // Every thing ok, file uploaded
            console.log(xhr.responseText); // handle response.
            hashimg = xhr.responseText;
            reshashimg = JSON.parse(hashimg);
            finhashimg = reshashimg.hashfile;

            var imgtx = {
              mobile: contactuid,
              type: "image",
              hashfile: finhashimg,
              descfile: "",
              myMedia: loadBase64(finhashimg)
            }

            console.log(imgtx);
            socket.emit('send_media', imgtx);

            $('#modalloading').removeClass('form-loading');

            $('#myModal3').modal('hide');

            var d = new Date();
            var bhour = d.getHours();
            var bminute = d.getMinutes();

            if (bminute < 10) {
              bminute = "0" + bminute;
            }

            var btime = '' + bhour + ':' + bminute + '';

            var menu = '';
            menu += previewimgr('https://cdn.ubicuacloud.com/file/' + finhashimg, operador, btime);

            $('#chat' + contactuid).append(menu);

            pageScroll();

          }
        };
        fd.append("inseririmg", file);
        xhr.send(fd);
        $('#inseririmg').val('');
      }

      /********************************************************************************************************************************************************/

      $('#inserirvid').change(function () {
        console.log('bate');
        var file = this.files[0];
        // This code is only for demo ...
        console.log("name : " + file.name);
        console.log("size : " + file.size);
        console.log("type : " + file.type);
        console.log("date : " + file.lastModified);
        uplvid();
      });

      var hashvid = "";
      var reshashvid;
      var finhashvid;

      function uplvid() {
        var file = inserirvid.files[0];
        console.log(">>>> Enviando novo video...");
        console.log("name : " + file.name);
        console.log("size : " + file.size);
        console.log("type : " + file.type);
        console.log("date : " + file.lastModified);
        console.log("");
        uploadFilevid(inserirvid.files[0]);

      }

      function uploadFilevid(file) {
        $('#modalloading').addClass('form-loading');
        var url = appwa;
        var xhr = new XMLHttpRequest();
        var fd = new FormData();
        xhr.open("POST", url, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            // Every thing ok, file uploaded
            console.log(xhr.responseText); // handle response.
            hashvid = xhr.responseText;
            reshashvid = JSON.parse(hashvid);
            finhashvid = reshashvid.hashfile;

            var vidtx = {
              mobile: contactuid,
              type: "video",
              hashfile: finhashvid,
              descfile: "",
              myMedia: loadBase64(finhashvid)
            }

            console.log(vidtx);
            socket.emit('send_media', vidtx);

            $('#modalloading').removeClass('form-loading');

            $('#myModal3').modal('hide');

            var d = new Date();
            var bhour = d.getHours();
            var bminute = d.getMinutes();

            if (bminute < 10) {
              bminute = "0" + bminute;
            }

            var btime = '' + bhour + ':' + bminute + '';


            var menu = '';
            menu += previewvidr('https://cdn.ubicuacloud.com/file/' + finhashvid, operador, btime);

            $('#chat' + contactuid).append(menu);

            pageScroll();

          }
        };
        fd.append("inserirvid", file);
        xhr.send(fd);
        $('#inserirvid').val('');
      }

      /********************************************************************************************************************************************************/

      $('#inseriraudio').change(function () {
        console.log('bate');
        var file = this.files[0];
        // This code is only for demo ...
        console.log("name : " + file.name);
        console.log("size : " + file.size);
        console.log("type : " + file.type);
        console.log("date : " + file.lastModified);
        uplaudio();
      });

      var hashaudio = "";
      var reshashaudio;
      var finhashaudio;

      function uplaudio() {
        var file = inseriraudio.files[0];
        console.log(">>>> Enviando novo audio...");
        console.log("name : " + file.name);
        console.log("size : " + file.size);
        console.log("type : " + file.type);
        console.log("date : " + file.lastModified);
        console.log("");
        uploadFileaudio(inseriraudio.files[0]);

      }

      function uploadFileaudio(file) {
        $('#modalloading').addClass('form-loading');
        var url = appwa;
        var xhr = new XMLHttpRequest();
        var fd = new FormData();
        xhr.open("POST", url, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            // Every thing ok, file uploaded
            console.log(xhr.responseText); // handle response.
            hashaudio = xhr.responseText;
            reshashaudio = JSON.parse(hashaudio);
            finhashaudio = reshashaudio.hashfile;

            var audiotx = {
              mobile: contactuid,
              type: "audio",
              hashfile: finhashaudio,
              descfile: "",
              myMedia: loadBase64(finhashaudio)
            }

            console.log(audiotx);
            socket.emit('send_media', audiotx);

            $('#modalloading').removeClass('form-loading');

            $('#myModal3').modal('hide');

            var d = new Date();
            var bhour = d.getHours();
            var bminute = d.getMinutes();

            if (bminute < 10) {
              bminute = "0" + bminute;
            }

            var btime = '' + bhour + ':' + bminute + '';


            var menu = '';
            menu += previewaudr('https://cdn.ubicuacloud.com/file/' + finhashaudio, operador, btime);

            $('#chat' + contactuid).append(menu);

            pageScroll();

          }
        };
        fd.append("inseriraudio", file);
        xhr.send(fd);
        $('#inseriraudio').val('');
      }

      /********************************************************************************************************************************************************/

      $('#inserirdoc').change(function () {
        console.log('bate');
        var file = this.files[0];
        // This code is only for demo ...
        console.log("name : " + file.name);
        console.log("size : " + file.size);
        console.log("type : " + file.type);
        console.log("date : " + file.lastModified);
        upldoc();
      });

      var hashdoc = "";
      var reshashdoc;
      var finhashdoc;
      var nomedoc;

      function upldoc() {
        var file = inserirdoc.files[0];
        console.log(">>>> Enviando novo doc...");
        console.log("name : " + file.name);
        nomedoc = file.name;
        console.log("size : " + file.size);
        console.log("type : " + file.type);
        console.log("date : " + file.lastModified);
        console.log("");
        uploadFiledoc(inserirdoc.files[0]);

      }

      function uploadFiledoc(file) {
        $('#modalloading').addClass('form-loading');
        var url = appwa;
        var xhr = new XMLHttpRequest();
        var fd = new FormData();
        xhr.open("POST", url, true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            // Every thing ok, file uploaded
            console.log(xhr.responseText); // handle response.
            hashdoc = xhr.responseText;
            reshashdoc = JSON.parse(hashdoc);
            finhashdoc = reshashdoc.hashfile;

            var doctx = {
              mobile: contactuid,
              type: "document",
              hashfile: finhashdoc,
              descfile: nomedoc,
              myMedia: loadBase64(finhashdoc)
            }

            console.log(doctx);
            socket.emit('send_media', doctx);

            $('#modalloading').removeClass('form-loading');

            $('#myModal3').modal('hide');

            var d = new Date();
            var bhour = d.getHours();
            var bminute = d.getMinutes();

            if (bminute < 10) {
              bminute = "0" + bminute;
            }

            var btime = '' + bhour + ':' + bminute + '';


            var menu = '';
            menu += previewdoctxr('https://cdn.ubicuacloud.com/file/' + finhashdoc, nomedoc, operador, btime);

            $('#chat' + contactuid).append(menu);

            pageScroll();

          }
        };
        fd.append("inserirdoc", file);
        xhr.send(fd);
        $('#inserirdoc').val('');
      }

      /********************************************************************************************************************************************************/

      var contPedidos;

      $('#addPedido').click(function () {
        var _segmento = $('#icbSegmento').val();
        var _pedido = $('#iPedido').val();
        var _valor = $('#iValor').val();

        if (_segmento != "" && _pedido != "" && _valor != "") {
          document.getElementById("fillWarning").style.display = "none";
          contPedidos = contPedidos + 1;
          var linhaTable = "<tr id='Pedido" + contPedidos + "'>";
          linhaTable += "<td>" + _segmento + "</td>";
          linhaTable += "<td>" + _pedido + "</td>";
          linhaTable += "<td>" + _valor + "</td>";
          linhaTable += "<td><button id='" + contPedidos + "' class='delButton' onclick='delPedido(this.id)'><i class='ion-trash-b'></i></button></td>";
          linhaTable += "</tr>";

          $("#myPedidos").append(linhaTable);

          $('#icbSegmento').val("");
          $('#iPedido').val("");
          $('#iValor').val("");
        } else {
          document.getElementById("fillWarning").innerHTML = "Preencha Todos Os Campos";
          document.getElementById("fillWarning").style.display = "inline";
        }
      });

      $("#icbStatus").change(function () {
        document.getElementById("fillWarning").style.display = "none";
        var myId = $('#icbStatus option:selected').attr("id");
        if (myId == 1 || myId == '1') {
          document.getElementById("boxContent").style.width = "70vw";
          document.getElementById("boxContent").style.height = "90vh";
          $("#myBoxgrid").addClass("boxGrid");
          $("#bdRightBox").addClass("bdRight");
          document.getElementById("listaPedido").style.display = "block";
          document.getElementById("novoPedido").style.display = "block";
        } else {
          clearTable()
        }
      });

      function clearTable() {
        contPedidos = 0;
        $("#myBoxgrid").removeClass("boxGrid");
        $("#bdRightBox").removeClass("bdRight");
        document.getElementById("listaPedido").style.display = "none";
        document.getElementById("novoPedido").style.display = "none";
        document.getElementById("boxContent").style.width = "600px";
        $('#myPedidos').empty();
      }

      function delPedido(data) {
        contPedidos = contPedidos - 1;
        $('#Pedido' + data).remove();
      }

      function tableJson() {
        var table = $('#myTable').tableToJSON({ onlyColumns: [0, 1, 2] });
        console.log(table);
        return table;
      }

      $('#confirmaenc').on('click', function () {
        if (contactuid != "") {
          var _stsel = $('#icbStatus option:selected').val();
          if (_stsel == "0") {
            alert('Selecione um Status para Encerrar o Atendimento !');
          } else {
            var myId = $('#icbStatus option:selected').attr("id");
            if (myId == 1 || myId == '1') {
              if (contPedidos != 0) {
                document.getElementById("fillWarning").style.display = "none";
                var table = tableJson();
                var _atendir;
                if ($("#reply" + contactuid).attr('class') == "ion-forward") {
                  _atendir = "out";
                } else if ($("#reply" + contactuid).attr('class') == "ion-reply") {
                  _atendir = "in";
                }
                var payload = {
                  mobile: contactuid,
                  status: $('#icbStatus').val(),
                  cnpj: $('#iCNPJ').val().replace(/[^\d]+/g, ''),
                  pedidos: table,
                  atendir: _atendir
                }
                $('#contatos').addClass('form-loading');
                socket.emit('bi-close_chat', payload);
                clearTable();
                $('#modalEncerrar').modal('hide');
              } else {
                document.getElementById("fillWarning").innerHTML = "Adicione ao Menos Um Pedido";
                document.getElementById("fillWarning").style.display = "inline";
              }
            } else {
              var table = tableJson();
              var _atendir;
              if ($("#reply" + contactuid).attr('class') == "ion-forward") {
                _atendir = "out";
              } else if ($("#reply" + contactuid).attr('class') == "ion-reply") {
                _atendir = "in";
              }
              var payload = {
                mobile: contactuid,
                status: $('#icbStatus').val(),
                cnpj: $('#iCNPJ').val().replace(/[^\d]+/g, ''),
                pedidos: table,
                atendir: _atendir
              }
              $('#contatos').addClass('form-loading');
              socket.emit('bi-close_chat', payload);
              clearTable();
              $('#modalEncerrar').modal('hide');
            }
          }
        } else {
          $('#myModal7').modal();
        }
      });

      $('#btnchamar').on('click', function () {
        $("#myModalchamar").modal();
      });

      $('#btnMulti').on('click', function () {
        var payload = {
          tipo: '1'
        };
        socket.emit('bi-mailativo', payload);
      });

      $('#btnHeavy').on('click', function () {
        var payload = {
          tipo: '2'
        };
        socket.emit('bi-mailativo', payload);
      });

      function loadBase64(hashFile) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
          if (this.readyState == 4 && this.status == 200) {
            return this.response
          }
        };
        xhttp.open("GET", "https://cdn.ubicuacloud.com/base64/" + hashFile, true);
        xhttp.send();
      }

      socket.on('bi-mailativo_old', function (payload) {
        if (payload != "" && payload != null) {
          var data = JSON.parse(payload);
          var dataSet = [];
          for (i = 0; data.length > i; i++) {
            var callBtn = '<button type="button" class="btn btn-primary" onclick="atenderMailing(' + data[i].mobile + ')"><span class="ion-person-add"></span>&nbsp;&nbsp;Chamar</button>';
            var row = [data[i].nome, data[i].nomefantasia, data[i].mobile, callBtn]
            dataSet.push(row);
          }
          console.log(dataSet);
          $('#table_id').dataTable({
            "destroy": true,
            "autoWidth": true,
            "pageLength": 10,
            "lengthChange": false,
            "data": dataSet,
            "ordering": false,
            columns: [
              { title: "Nome" },
              { title: "Nome Fantasia" },
              { title: "Numero" },
              { title: "Chamar" }
            ],
            "language": {
              "sEmptyTable": "Nenhum registro encontrado",
              "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
              "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
              "sInfoFiltered": "(Filtrados de MAX registros)",
              "sInfoPostFix": "",
              "sInfoThousands": ".",
              "sLengthMenu": "",
              "sLoadingRecords": "Carregando...",
              "sProcessing": "Processando...",
              "sZeroRecords": "Nenhum registro encontrado",
              "sSearch": "Pesquisar",
              "oPaginate": {
                "sNext": "Próximo",
                "sPrevious": "Anterior",
                "sFirst": "Primeiro",
                "sLast": "Último"
              },
              "oAria": {
                "sSortAscending": ": Ordenar colunas de forma ascendente",
                "sSortDescending": ": Ordenar colunas de forma descendente"
              }
            }
          });
          $("#mailModal").modal();
        } else {
          $("#modalNoMail").modal("toggle");
        }
      });

      socket.on('bi-mailativo', function (payload) {
        if (payload != "" && payload != null) {
          allClients = []
          var data = JSON.parse(payload);
          var dataSet = [];
          for (i = 0; data.length > i; i++) {
            var callBtn = '<button type="button" class="btn btn-primary" onclick="atenderMailing(' + data[i].mobile + ')"><span class="ion-person-add"></span>&nbsp;&nbsp;Chamar</button>';
            var sellBtn = '<button id="clibtn' + data[i].mobile + '" type="button" class="btn btn-success" onclick="addClientToAll(' + data[i].mobile + ')">Selecionar</button>'; var row = [data[i].nome, data[i].nomefantasia, data[i].flagcampanha, data[i].cnpj, data[i].mobile, callBtn, sellBtn]
            dataSet.push(row);
          }
          console.log(dataSet);
          $('#table_id').dataTable({
            "destroy": true,
            "autoWidth": true,
            "pageLength": 10,
            "lengthChange": false,
            "data": dataSet,
            "ordering": false,
            columns: [
              { title: "Nome" },
              { title: "Nome Fantasia" },
              { title: "Flag Campanha" },
              { title: "Cnpj" },
              { title: "Numero" },
              { title: "Chamar" },
              { title: "Selecionar" }
            ],
            "language": {
              "sEmptyTable": "Nenhum registro encontrado",
              "sInfo": "Mostrando de _START_ até _END_ de _TOTAL_ registros",
              "sInfoEmpty": "Mostrando 0 até 0 de 0 registros",
              "sInfoFiltered": "(Filtrados de MAX registros)",
              "sInfoPostFix": "",
              "sInfoThousands": ".",
              "sLengthMenu": "",
              "sLoadingRecords": "Carregando...",
              "sProcessing": "Processando...",
              "sZeroRecords": "Nenhum registro encontrado",
              "sSearch": "Pesquisar",
              "oPaginate": {
                "sNext": "Próximo",
                "sPrevious": "Anterior",
                "sFirst": "Primeiro",
                "sLast": "Último"
              },
              "oAria": {
                "sSortAscending": ": Ordenar colunas de forma ascendente",
                "sSortDescending": ": Ordenar colunas de forma descendente"
              }
            }
          });
          $("#mailModal").modal();
        } else {
          $("#modalNoMail").modal("toggle");
        }
      });

      $("#callAll").on("click", function () {
        for (i = 0; i < allClients.length; i++) {
          var payload = {
            fkid: sessionStorage.getItem('fkid'),
            fkname: sessionStorage.getItem('fkname'),
            mobile: allClients[i].mobile
          };
          socket.emit('bi-atendemail', payload);
        }
      });


      socket.on("bi-atendemail", function (payload) {
        console.log(payload);
        if (payload.status == '200') {
          socket.emit('bi-atendein', { fkid: sessionStorage.getItem('fkid') });
        } else {
          $("#modalAtende").modal("toggle")
        }
      });

      function atenderMailing(mobile) {
        $("#mailModal").modal('hide');
        var payload = {
          fkid: sessionStorage.getItem('fkid'),
          fkname: sessionStorage.getItem('fkname'),
          mobile: mobile
        };
        socket.emit('bi-atendemail', payload);
      }

      function addClientToAll(mobile) {
        if ($("#clibtn" + mobile).hasClass("btn-success") == true) {
          $("#clibtn" + mobile).addClass('btn-warning');
          $("#clibtn" + mobile).removeClass('btn-success');
          allClients.push({
            'mobile': mobile
          })
        } else if ($("#clibtn" + mobile).hasClass("btn-warning") == true) {
          $("#clibtn" + mobile).addClass('btn-success');
          $("#clibtn" + mobile).removeClass('btn-warning');
          for (i = 0; i < allClients.length; i++) {
            if (allClients[i].mobile == mobile) {
              allClients.splice(i, 1);
            }
          }
        }
      }


    </script>
</body>

</html>